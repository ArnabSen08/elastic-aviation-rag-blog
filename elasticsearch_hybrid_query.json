{
  "description": "Production-ready Elasticsearch Hybrid Search Query for Aviation Maintenance Manuals",
  "ready_to_paste_query": {
    "size": 10,
    "rank": {
      "rrf": {
        "window_size": 100,
        "rank_constant": 60
      }
    },
    "sub_searches": [
      {
        "query": {
          "bool": {
            "should": [
              {
                "multi_match": {
                  "query": "{{SEARCH_QUERY}}",
                  "fields": ["content^2", "section^1.5", "title^1.8"],
                  "type": "best_fields",
                  "boost": 1.0
                }
              },
              {
                "match_phrase": {
                  "content": {
                    "query": "{{SEARCH_QUERY}}",
                    "boost": 1.5,
                    "slop": 2
                  }
                }
              }
            ],
            "minimum_should_match": 1
          }
        }
      },
      {
        "query": {
          "knn": {
            "field": "embedding",
            "query_vector": "{{384_DIM_VECTOR}}",
            "k": 100,
            "num_candidates": 1000,
            "boost": 2.0
          }
        }
      },
      {
        "query": {
          "bool": {
            "should": [
              {
                "wildcard": {
                  "part_number": {
                    "value": "*{{PART_SEARCH}}*",
                    "boost": 2.5
                  }
                }
              },
              {
                "match": {
                  "section": {
                    "query": "{{SEARCH_QUERY}}",
                    "boost": 1.3
                  }
                }
              }
            ]
          }
        }
      }
    ],
    "_source": [
      "content",
      "page", 
      "section",
      "part_number"
    ],
    "highlight": {
      "fields": {
        "content": {
          "fragment_size": 200,
          "number_of_fragments": 3,
          "pre_tags": ["<mark>"],
          "post_tags": ["</mark>"]
        },
        "section": {
          "fragment_size": 100,
          "number_of_fragments": 1
        }
      }
    }
  },
  "example_queries": {
    "apu_reset_example": {
      "size": 10,
      "rank": {
        "rrf": {
          "window_size": 100,
          "rank_constant": 60
        }
      },
      "sub_searches": [
        {
          "query": {
            "bool": {
              "should": [
                {
                  "multi_match": {
                    "query": "APU master warning reset procedure",
                    "fields": ["content^2", "section^1.5", "title^1.8"],
                    "type": "best_fields",
                    "boost": 1.0
                  }
                },
                {
                  "match_phrase": {
                    "content": {
                      "query": "APU master warning reset",
                      "boost": 1.5,
                      "slop": 2
                    }
                  }
                }
              ],
              "minimum_should_match": 1
            }
          }
        },
        {
          "query": {
            "knn": {
              "field": "embedding",
              "query_vector": [0.1, -0.2, 0.05, 0.8],
              "k": 100,
              "num_candidates": 1000,
              "boost": 2.0
            }
          }
        },
        {
          "query": {
            "bool": {
              "should": [
                {
                  "wildcard": {
                    "part_number": {
                      "value": "*APU*",
                      "boost": 2.5
                    }
                  }
                },
                {
                  "match": {
                    "section": {
                      "query": "APU warnings emergency procedures",
                      "boost": 1.3
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "_source": [
        "content",
        "page",
        "section", 
        "part_number"
      ],
      "highlight": {
        "fields": {
          "content": {
            "fragment_size": 200,
            "number_of_fragments": 3,
            "pre_tags": ["<mark>"],
            "post_tags": ["</mark>"]
          },
          "section": {
            "fragment_size": 100,
            "number_of_fragments": 1
          }
        }
      }
    },
    "hydraulic_system_example": {
      "size": 15,
      "rank": {
        "rrf": {
          "window_size": 150,
          "rank_constant": 40
        }
      },
      "sub_searches": [
        {
          "query": {
            "bool": {
              "should": [
                {
                  "multi_match": {
                    "query": "hydraulic system pressure loss troubleshooting",
                    "fields": ["content^2", "section^1.5", "title^1.8"],
                    "type": "best_fields",
                    "boost": 1.0
                  }
                },
                {
                  "match_phrase": {
                    "content": {
                      "query": "hydraulic pressure loss",
                      "boost": 1.5,
                      "slop": 2
                    }
                  }
                }
              ],
              "minimum_should_match": 1
            }
          }
        },
        {
          "query": {
            "knn": {
              "field": "embedding", 
              "query_vector": [0.3, -0.1, 0.7, 0.2],
              "k": 150,
              "num_candidates": 1500,
              "boost": 2.0
            }
          }
        },
        {
          "query": {
            "bool": {
              "should": [
                {
                  "wildcard": {
                    "part_number": {
                      "value": "*HYD*",
                      "boost": 2.5
                    }
                  }
                },
                {
                  "match": {
                    "section": {
                      "query": "hydraulic systems maintenance",
                      "boost": 1.3
                    }
                  }
                }
              ]
            }
          }
        }
      ],
      "_source": [
        "content",
        "page",
        "section",
        "part_number"
      ]
    }
  },
  "configuration_notes": {
    "embedding_model": "sentence-transformers/all-MiniLM-L6-v2 (384 dimensions)",
    "rrf_explanation": "Reciprocal Rank Fusion combines BM25 keyword search, vector similarity, and metadata matching",
    "tuning_parameters": {
      "window_size": "Number of top results from each sub-search to consider (100-150 recommended)",
      "rank_constant": "Controls fusion weighting (40-80 range, lower = more aggressive fusion)",
      "boost_values": {
        "content": "2.0 - Primary content field",
        "section": "1.5 - Section titles",
        "title": "1.8 - Document titles", 
        "knn": "2.0 - Vector search results",
        "part_number": "2.5 - Exact part matches"
      }
    },
    "field_requirements": {
      "content": "Main text content (analyzed)",
      "embedding": "384-dim dense vector field",
      "section": "Section/chapter names (analyzed)",
      "part_number": "Part numbers (keyword field)",
      "page": "Page numbers (integer)",
      "title": "Document/section titles (analyzed)"
    }
  }
}
